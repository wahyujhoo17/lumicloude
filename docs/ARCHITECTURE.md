# ðŸ“Š LumiCloud Backend Architecture

## ðŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Next.js)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Home   â”‚  â”‚ Pricing â”‚  â”‚ Login   â”‚  â”‚Dashboardâ”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ API Calls
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Next.js API Routes (Backend)                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Authentication  â”‚  â”‚    Payment API   â”‚               â”‚
â”‚  â”‚  - Register      â”‚  â”‚  - Create Order  â”‚               â”‚
â”‚  â”‚  - Login         â”‚  â”‚  - iPaymu        â”‚               â”‚
â”‚  â”‚  - Session       â”‚  â”‚  - Callback      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Order API      â”‚  â”‚   Website API    â”‚               â”‚
â”‚  â”‚  - List Orders   â”‚  â”‚  - Create Site   â”‚               â”‚
â”‚  â”‚  - Get Detail    â”‚  â”‚  - Deploy        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Upload API     â”‚  â”‚  Dashboard API   â”‚               â”‚
â”‚  â”‚  - Upload File   â”‚  â”‚  - Statistics    â”‚               â”‚
â”‚  â”‚  - List Files    â”‚  â”‚  - User Info     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                      â”‚                  â”‚
         â–¼                      â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚   â”‚     iPaymu      â”‚  â”‚   aaPanel   â”‚
â”‚                 â”‚   â”‚  Payment Gatewayâ”‚  â”‚  Hosting    â”‚
â”‚  - Users        â”‚   â”‚                 â”‚  â”‚  Panel      â”‚
â”‚  - Orders       â”‚   â”‚  - Create Trx   â”‚  â”‚             â”‚
â”‚  - Subscriptionsâ”‚   â”‚  - Callback     â”‚  â”‚  - Create   â”‚
â”‚  - Websites     â”‚   â”‚  - VA/QRIS/etc  â”‚  â”‚    Website  â”‚
â”‚  - FileUploads  â”‚   â”‚                 â”‚  â”‚  - Deploy   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Payment Flow

```
User                Frontend              API Routes           iPaymu          Database
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚  1. Pilih Paket    â”‚                      â”‚                  â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚  2. Create Payment  â”‚                  â”‚                â”‚
 â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  3. Create Trx   â”‚                â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  4. Payment URL  â”‚                â”‚
 â”‚                     â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  5. Save Order   â”‚                â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚  6. Redirect URL     â”‚                  â”‚                â”‚
 â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚  7. Redirect        â”‚                      â”‚                  â”‚                â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚  8. Pilih Metode Bayar (VA/QRIS)          â”‚                  â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚  9. Bayar           â”‚                      â”‚                  â”‚                â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  10. Webhook     â”‚                â”‚
 â”‚                     â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  11. Update Orderâ”‚                â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚                     â”‚                      â”‚  12. Create Sub  â”‚                â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                     â”‚                      â”‚                  â”‚                â”‚
 â”‚  13. Success Page   â”‚                      â”‚                  â”‚                â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚                â”‚
```

---

## ðŸš€ Website Deployment Flow

```
User              API Routes           aaPanel            Database
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  1. Create Site   â”‚                    â”‚                  â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                  â”‚
 â”‚                   â”‚  2. Create Website â”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚                   â”‚  3. FTP Credentialsâ”‚                  â”‚
 â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚                   â”‚  4. Save Website   â”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  5. Website Info  â”‚                    â”‚                  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  6. Upload ZIP    â”‚                    â”‚                  â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                  â”‚
 â”‚                   â”‚  7. Save File      â”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  8. Deploy        â”‚                    â”‚                  â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                  â”‚
 â”‚                   â”‚  9. Upload to FTP  â”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚                   â”‚  10. Extract ZIP   â”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚                   â”‚  11. Set Permissionâ”‚                  â”‚
 â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  12. Success      â”‚                    â”‚                  â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                  â”‚
 â”‚                   â”‚                    â”‚                  â”‚
 â”‚  ðŸŒ Website Live! â”‚                    â”‚                  â”‚
```

---

## ðŸ“‚ File Structure

```
lumicloud/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ [...nextauth]/route.ts  # NextAuth handler
â”‚   â”‚   â”‚   â””â”€â”€ register/route.ts       # User registration
â”‚   â”‚   â”œâ”€â”€ payment/
â”‚   â”‚   â”‚   â”œâ”€â”€ create/route.ts         # Create payment
â”‚   â”‚   â”‚   â””â”€â”€ callback/route.ts       # Payment webhook
â”‚   â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts                # List orders
â”‚   â”‚   â”‚   â””â”€â”€ [id]/route.ts           # Order detail
â”‚   â”‚   â”œâ”€â”€ dashboard/route.ts          # Dashboard stats
â”‚   â”‚   â”œâ”€â”€ upload/route.ts             # File upload
â”‚   â”‚   â””â”€â”€ website/
â”‚   â”‚       â”œâ”€â”€ create/route.ts         # Create website
â”‚   â”‚       â””â”€â”€ deploy/route.ts         # Deploy website
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”œâ”€â”€ Hero.tsx
â”‚   â”œâ”€â”€ Features.tsx
â”‚   â”œâ”€â”€ Pricing.tsx
â”‚   â”œâ”€â”€ Testimonials.tsx
â”‚   â””â”€â”€ Footer.tsx
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prisma.ts        # Prisma client
â”‚   â”œâ”€â”€ auth.ts          # NextAuth config
â”‚   â”œâ”€â”€ ipaymu.ts        # iPaymu service
â”‚   â”œâ”€â”€ aapanel.ts       # aaPanel service
â”‚   â”œâ”€â”€ helpers.ts       # Utility functions
â”‚   â””â”€â”€ utils.ts         # Tailwind utils
â”‚
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma    # Database schema
â”‚   â””â”€â”€ seed.ts          # Database seeder
â”‚
â”œâ”€â”€ types/
â”‚   â””â”€â”€ next-auth.d.ts   # NextAuth types
â”‚
â”œâ”€â”€ middleware.ts        # Auth middleware
â”œâ”€â”€ .env                 # Environment variables
â”œâ”€â”€ .env.example         # Environment template
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â”œâ”€â”€ next.config.js
â”œâ”€â”€ BACKEND_README.md    # API Documentation
â””â”€â”€ SETUP_GUIDE.md       # Setup instructions
```

---

## ðŸ” Environment Variables

```env
# Database
DATABASE_URL="postgresql://..."

# NextAuth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="..."

# iPaymu
IPAYMU_VA="..."
IPAYMU_API_KEY="..."
IPAYMU_ENV="sandbox"

# aaPanel
AAPANEL_URL="https://..."
AAPANEL_API_KEY="..."
```

---

## ðŸ› ï¸ Tech Stack

| Layer         | Technology  | Purpose                |
| ------------- | ----------- | ---------------------- |
| Frontend      | Next.js 14  | React framework        |
| Backend       | Next.js API | API endpoints          |
| Database      | PostgreSQL  | Relational database    |
| ORM           | Prisma      | Database toolkit       |
| Auth          | NextAuth.js | Authentication         |
| Payment       | iPaymu      | Payment gateway        |
| Hosting Panel | aaPanel     | Web hosting management |
| File Upload   | Multer      | Multipart form data    |
| Validation    | bcryptjs    | Password hashing       |
| HTTP Client   | Axios       | API requests           |

---

## ðŸ“Š Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
      â”‚            â”‚
      â”‚ 1:N        â”‚ 1:N
      â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Order   â”‚  â”‚ Subscription â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚               â”‚
      â”‚ 1:1           â”‚ 1:1
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Website  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 1:N
              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ FileUpload   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ Key Features

### âœ… Authentication & Authorization

- User registration & login
- JWT session management
- Protected API routes
- Password hashing

### ðŸ’³ Payment Integration

- iPaymu payment gateway
- Multiple payment methods (VA, QRIS, etc)
- Webhook callback handling
- Auto order status update

### ðŸ“¦ Subscription Management

- Monthly/yearly billing
- Auto-renewal
- Subscription status tracking
- Expiry notifications

### ðŸŒ Website Management

- Auto-create hosting account
- FTP credentials generation
- File upload & deployment
- SSL certificate setup

### ðŸ“¤ File Upload & Deployment

- ZIP/TAR.GZ upload
- Auto-extract files
- Permission management
- Deploy to live server

---

**ðŸš€ Ready to deploy!**
